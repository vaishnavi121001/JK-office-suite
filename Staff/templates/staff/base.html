<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Staff Dashboard{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #eaeaea;
            color: #000000;
        }

        .navbar {
            background-color: #002147;
            border-bottom: 1px solid #ccc;
        }

        .navbar-brand {
            color: #ffffff !important;
        }

        .navbar .nav-link {
            color: #ffffff;
        }

        .navbar .nav-link:hover {
            color: #dddddd;
        }

        .sidebar {
            background-color: #002147;
            border-right: 1px solid #ccc;
            min-height: 100vh;
        }

        .sidebar .nav-link {
            color: #ffffff;
        }

        .nav-link.active {
            background-color: #004080 !important;
            color: white !important;
        }

        main {
            background-color: #ffffff;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }

        .btn {
            background-color: #6c757d;
            color: white;
        }

        .btn:hover {
            background-color: #5a6268;
        }

        .dark-mode {
            background-color: #121212 !important;
            color: #f1f1f1 !important;
        }

        .dark-mode .navbar,
        .dark-mode .sidebar,
        .dark-mode main {
            background-color: #1e1e1e !important;
            color: white !important;
        }

        .dark-mode .card {
            background-color: #2c2c2c !important;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>

<!-- Top Navbar -->
<nav class="navbar navbar-expand-lg navbar-light shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Staff Dashboard</a>
        <div class="d-flex">
            <button class="btn btn-sm text-white me-2" onclick="toggleDarkMode()">
                <i class="fas fa-moon"></i>
            </button>
            <a class="nav-link" href="{% url 'staff_profile' %}" style="margin-right: 15px;">Profile</a>
            <a class="nav-link" href="{% url 'staff_notifications' %}" style="margin-right: 15px;">Notifications</a>

                <button class="btn btn-danger" onclick="handleLogout()">Logout</button>


        </div>
    </div>
</nav>

<!-- Layout -->
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-2 d-none d-md-block sidebar">
            <ul class="nav flex-column mt-3">
                <li class="nav-item"><a class="nav-link" href="{% url 'staff_dashboard' %}"><i class="fas fa-home me-2"></i>Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'staff_tasks' %}"><i class="fas fa-tasks me-2"></i>Tasks</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'staff_attendance' %}"><i class="fas fa-user-check me-2"></i>Attendance</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'staff_leave' %}"><i class="fas fa-plane-departure me-2"></i>Leave</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'staff_messages' %}"><i class="fas fa-envelope me-2"></i>Messages</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'staff_profile' %}"><i class="fas fa-user me-2"></i>Profile</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="col-md-10 ms-sm-auto px-md-4 mt-4 animate__animated animate__fadeIn">
            {% block content %}
            <div class="row">
                <div class="col-md-6">
                    <h5>üìä Attendance Overview</h5>
                    <canvas id="attendanceChart"></canvas>
                </div>
                <div class="col-md-6">
                    <h5>üóÇÔ∏è Task Status</h5>
                    <canvas id="taskChart"></canvas>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card p-3">
                        <h6>‚è≥ Deadline: Submit Report</h6>
                        <p id="countdown" class="text-danger fw-bold"></p>
                    </div>
                </div>
            </div>
            {% endblock %}
        </main>
    </div>
</div>

{% block extra_js %}
<script>

    const attendanceChart = new Chart(document.getElementById('attendanceChart'), {
        type: 'doughnut',
        data: {
            labels: ['Present', 'Absent', 'Leave'],
            datasets: [{
                data: [26, 2, 2],
                backgroundColor: ['#4caf50', '#f44336', '#ff9800']
            }]
        }
    });

    const taskChart = new Chart(document.getElementById('taskChart'), {
        type: 'bar',
        data: {
            labels: ['Pending', 'Completed', 'Overdue'],
            datasets: [{
                label: 'Tasks',
                data: [3, 5, 1],
                backgroundColor: ['#2196f3', '#4caf50', '#f44336']
            }]
        }
    });

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
    }

    function updateCountdown() {
        const deadline = new Date("2025-05-05T17:00:00").getTime();
        const now = new Date().getTime();
        const distance = deadline - now;

        if (distance < 0) {
            document.getElementById("countdown").innerHTML = "‚úÖ Task Deadline Passed";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance / (1000 * 60 * 60)) % 24);
        const mins = Math.floor((distance / (1000 * 60)) % 60);
        const secs = Math.floor((distance / 1000) % 60);

        document.getElementById("countdown").innerHTML = `${days}d ${hours}h ${mins}m ${secs}s left`;
    }

    setInterval(updateCountdown, 1000);

async function handleLogout() {
    const response = await fetch("{% url 'check_tasks_and_logout' %}");
    const result = await response.json();

    if (result.success) {
        alert("‚úÖ Your attendance is recorded successfully.");
        window.location.href = "{% url 'home' %}";
    } else {
        alert("‚ö†Ô∏è You must submit all tasks first.");
        window.location.href = "{% url 'staff_tasks' %}";
    }
}


</script>
{% endblock %}
</body>
</html>